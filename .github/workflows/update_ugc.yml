name: Update UGC Data
permissions:
  contents: write

on:
  schedule:
    - cron: "0 0 * * *"  # Läuft täglich um 00:00 UTC
  workflow_dispatch:  # Manuelles Starten erlaubt

jobs:
  update_json:
    runs-on: ubuntu-latest
    steps:
      - name: Repository auschecken
        uses: actions/checkout@v3

      - name: Fetch UGC Data mit Client-Version
        run: |
          VERSION=$(curl -s "https://play.pixels.xyz/version.json" | tr -d '"')
          curl -s "https://pixels-server.pixels.xyz/v1/game/library?tenant=pixels&ugc=true&ver=$VERSION" -o ugc.json

      - name: Prüfen, ob Datei gültig ist
        run: |
          if ! jq empty ugc.json > /dev/null 2>&1; then
            echo "❌ Fehler: JSON-Datei ist ungültig oder leer!"
            exit 1
          fi
          echo "✅ UGC-Daten erfolgreich geladen!"

      - name: Commit und Push Änderungen
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add ugc.json
          git commit -m "Auto-Update UGC Data [$(date)]" || echo "Keine Änderungen zum Commit."
          git push || echo "Kein Push nötig, keine Änderungen."
