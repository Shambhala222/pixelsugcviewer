name: Update UGC Data
permissions:
  contents: write

on:
  schedule:
    - cron: "0 0 * * *"  # L√§uft t√§glich um 00:00 UTC
  workflow_dispatch:  # Manuelles Starten erlaubt

jobs:
  update_json:
    runs-on: ubuntu-latest
    steps:
      - name: Repository auschecken
        uses: actions/checkout@v3

      - name: Fetch UGC Data mit Redirect-Fix
        run: |
          VERSION=$(curl -s "https://play.pixels.xyz/version.json" | tr -d '"')
          echo "üì¢ Aktuelle Client-Version: $VERSION"

          curl -s -L -H "x-client-version: $VERSION" \
               "https://pixels-server.pixels.xyz/v1/game/library?tenant=pixels&ugc=true&ver=$VERSION" -o ugc.json

      - name: Pr√ºfen, ob Datei g√ºltig ist
        run: |
          if ! jq empty ugc.json > /dev/null 2>&1; then
            echo "‚ùå Fehler: JSON-Datei ist ung√ºltig oder leer!"
            cat ugc.json  # Zeigt den Inhalt f√ºr Debugging
            exit 1
          fi
          echo "‚úÖ UGC-Daten erfolgreich geladen!"

      - name: Commit und Push √Ñnderungen
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add ugc.json
          git commit -m "Auto-Update UGC Data [$(date)]" || echo "‚ÑπÔ∏è Keine √Ñnderungen zum Commit."
          git push || echo "‚ÑπÔ∏è Kein Push n√∂tig, keine √Ñnderungen."
